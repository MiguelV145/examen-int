import{a as X}from"./chunk-LNA3DTEN.js";import{a as Q}from"./chunk-DW4Q7GJY.js";import{h as K}from"./chunk-IOC3E3MC.js";import{c as V,j as F}from"./chunk-WCVVC2EY.js";import{a as k,b as I,c as O,d as W,e as L,f as B,g as j,h as G,i as H,j as U,k as J,l as $,m as q,n as z}from"./chunk-BTHVBUZ4.js";import{Ca as w,Cb as D,Na as v,P as c,Pa as _,Qb as P,Ra as C,Sa as h,T as p,Ta as f,U as u,Ua as r,Va as i,Wa as b,ab as y,da as g,db as S,fb as m,lb as T,nb as o,ob as x,qb as A,ra as l,rb as E,sb as M,tb as N}from"./chunk-D5HNOFHB.js";var Z=(a,t)=>t.id;function ee(a,t){a&1&&(r(0,"div",2),b(1,"span",4),i())}function te(a,t){if(a&1&&(r(0,"option",11),o(1),i()),a&2){let e=t.$implicit;f("value",e.id),l(),x(e.displayName||e.username)}}function ie(a,t){if(a&1){let e=y();r(0,"button",26),S("click",function(){let s=p(e).$implicit,d=m(3);return u(d.onSlotSelected(s))}),r(1,"span"),o(2),i()()}if(a&2){let e=t.$implicit,n=m(3);T("btn-primary",n.selectedSlotId()===e.id),l(2),A("",n.getDayName(e.dayOfWeek)," - ",e.startTime," a ",e.endTime)}}function re(a,t){if(a&1&&(r(0,"div",6)(1,"label",7)(2,"span",8),o(3,"Horarios Disponibles"),i()(),r(4,"div",24),C(5,ie,3,5,"button",25,Z),i()()),a&2){let e=m(2);l(5),h(e.availableSlots())}}function ae(a,t){a&1&&(r(0,"div",13)(1,"span"),o(2,"No hay horarios disponibles para este programador."),i()())}function oe(a,t){if(a&1&&(r(0,"div")(1,"p",17),o(2,"Programador"),i(),r(3,"p",18),o(4),i()()),a&2){let e=m(2);l(4),x(e.selectedProgrammerName())}}function ne(a,t){if(a&1&&(r(0,"div")(1,"p",17),o(2,"Fecha y Hora"),i(),r(3,"p",18),o(4),i()()),a&2){let e=m(2);l(4),A("",e.getDayName(e.selectedSlot().dayOfWeek)," - ",e.selectedSlot().startTime," a ",e.selectedSlot().endTime)}}function se(a,t){if(a&1){let e=y();r(0,"div",3)(1,"div",5)(2,"div",6)(3,"label",7)(4,"span",8),o(5,"Seleccionar Programador"),i()(),r(6,"select",9),S("change",function(s){p(e);let d=m();return u(d.onProgrammerSelected(s))}),N("ngModelChange",function(s){p(e);let d=m();return M(d.selectedProgrammerId,s)||(d.selectedProgrammerId=s),u(s)}),r(7,"option",10),o(8,"Elige un programador"),i(),C(9,te,2,2,"option",11,Z),i()(),r(11,"div",6)(12,"label",7)(13,"span",8),o(14,"Modalidad"),i()(),r(15,"select",12),N("ngModelChange",function(s){p(e);let d=m();return M(d.selectedModality,s)||(d.selectedModality=s),u(s)}),S("change",function(){p(e);let s=m();return u(s.onModalitySelected())}),r(16,"option"),o(17,"PRESENCIAL"),i(),r(18,"option"),o(19,"VIRTUAL"),i(),r(20,"option"),o(21,"HIBRIDA"),i()()(),v(22,re,7,0,"div",6)(23,ae,3,0,"div",13),i(),r(24,"div",14)(25,"div",15)(26,"h2",16),o(27,"Resumen de la Reserva"),i(),v(28,oe,5,1,"div"),v(29,ne,5,3,"div"),r(30,"div")(31,"p",17),o(32,"Modalidad"),i(),r(33,"p",18),o(34),i()(),r(35,"form",19)(36,"div",6)(37,"label",7)(38,"span",20),o(39,"Tema de la asesor\xEDa"),i()(),b(40,"input",21),i(),r(41,"div",6)(42,"label",7)(43,"span",20),o(44,"Notas adicionales"),i()(),b(45,"textarea",22),i(),r(46,"button",23),S("click",function(){p(e);let s=m();return u(s.onSubmit())}),o(47," Confirmar Reserva "),i()()()()()}if(a&2){let e=m();l(6),E("ngModel",e.selectedProgrammerId),l(3),h(e.programmers()),l(6),E("ngModel",e.selectedModality),l(7),_(e.availableSlots().length>0?22:e.selectedProgrammerId?23:-1),l(6),_(e.selectedProgrammerName()?28:-1),l(),_(e.selectedSlot()?29:-1),l(5),x(e.selectedModality),l(),f("formGroup",e.reservaForm),l(11),f("disabled",!e.canSubmit()||e.reservaForm.invalid)}}var Y=class a{fb=c($);asesoriasApi=c(Q);availabilityApi=c(X);authStore=c(F);router=c(V);toastr=c(K);loading=g(!1);programmers=g([]);availableSlots=g([]);selectedProgrammerId="";selectedModality="VIRTUAL";selectedSlotId=g(null);selectedSlot=g(null);selectedProgrammerName=D(()=>{let t=this.programmers().find(e=>e.id==this.selectedProgrammerId);return t?.displayName||t?.username||""});canSubmit=D(()=>this.selectedProgrammerId&&this.selectedSlotId()!==null&&this.reservaForm.valid);reservaForm=this.fb.group({topic:["",[I.required,I.minLength(5)]],notes:[""]});ngOnInit(){this.loadProgrammers()}loadProgrammers(){this.loading.set(!0),this.asesoriasApi.getProgrammersAvailable().subscribe({next:t=>{this.programmers.set(t),this.loading.set(!1)},error:t=>{this.toastr.error(this.getErrorMessage(t,"No se pudieron cargar los programadores.")),this.loading.set(!1)}})}onProgrammerSelected(t){this.selectedProgrammerId=t.target.value,this.availableSlots.set([]),this.selectedSlotId.set(null),this.selectedSlot.set(null),this.loadAvailableSlots()}loadAvailableSlots(){this.selectedProgrammerId&&this.availabilityApi.getSlotsByProgrammer(Number(this.selectedProgrammerId)).subscribe({next:t=>{let e=t.filter(n=>n.enabled&&n.modality===this.selectedModality);this.availableSlots.set(e)},error:t=>{this.toastr.error(this.getErrorMessage(t,"No se pudieron cargar los horarios disponibles."))}})}onModalitySelected(){this.selectedSlotId.set(null),this.selectedSlot.set(null),this.loadAvailableSlots()}onSlotSelected(t){this.selectedSlotId.set(t.id),this.selectedSlot.set(t)}onSubmit(){if(!this.canSubmit())return;this.loading.set(!0);let t=this.selectedSlot(),e=new Date,n=this.calculateDateTime(e,t.dayOfWeek,t.startTime),s={programmerId:Number(this.selectedProgrammerId),startAt:n.toISOString(),durationMinutes:60,modality:this.selectedModality,topic:this.reservaForm.get("topic")?.value??void 0,notes:this.reservaForm.get("notes")?.value??void 0};this.asesoriasApi.createAsesoria(s).subscribe({next:d=>{this.loading.set(!1),this.toastr.success("Asesor\xEDa reservada correctamente"),this.router.navigate(["/mis-asesorias"])},error:d=>{this.loading.set(!1),this.toastr.error(this.getErrorMessage(d,"No se pudo reservar la asesor\xEDa."))}})}getErrorMessage(t,e){let n=t?.error?.message||t?.error?.details;return n||(t?.status?`Error ${t.status}: ${t.statusText||e}`:t?.message?.includes("Network")?"Error de conexion. Verifica tu conexion a internet.":e)}calculateDateTime(t,e,n){let[s,d]=n.split(":").map(Number),R=new Date(t);return R.setHours(s,d,0,0),R}getDayName(t){return{LUNES:"Lunes",MARTES:"Martes",MIERCOLES:"Mi\xE9rcoles",JUEVES:"Jueves",VIERNES:"Viernes",SABADO:"S\xE1bado",DOMINGO:"Domingo"}[t]}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=w({type:a,selectors:[["app-reservar-asesoria"]],decls:5,vars:1,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","mb-6"],[1,"flex","justify-center","py-8"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-8"],[1,"loading","loading-spinner","loading-lg"],[1,"space-y-6"],[1,"form-control"],[1,"label"],[1,"label-text","font-semibold"],[1,"select","select-bordered",3,"change","ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value"],[1,"select","select-bordered",3,"ngModelChange","change","ngModel"],[1,"alert","alert-warning"],[1,"card","bg-base-200"],[1,"card-body"],[1,"card-title"],[1,"text-sm","opacity-75"],[1,"font-semibold"],[1,"space-y-4",3,"formGroup"],[1,"label-text"],["type","text","placeholder","Ej: Dudas sobre Angular","formControlName","topic",1,"input","input-bordered"],["placeholder","Informaci\xF3n adicional...","formControlName","notes",1,"textarea","textarea-bordered"],["type","button",1,"btn","btn-primary","w-full",3,"click","disabled"],[1,"space-y-2","max-h-60","overflow-y-auto"],["type","button",1,"btn","btn-outline","w-full","justify-start",3,"btn-primary"],["type","button",1,"btn","btn-outline","w-full","justify-start",3,"click"]],template:function(e,n){e&1&&(r(0,"div",0)(1,"h1",1),o(2,"Reservar Asesor\xEDa"),i(),v(3,ee,2,0,"div",2)(4,se,48,8,"div",3),i()),e&2&&(l(3),_(n.loading()?3:4))},dependencies:[P,z,B,U,J,k,H,O,W,G,j,q,L],encapsulation:2,changeDetection:0})};export{Y as ReservarAsesoriaComponent};
