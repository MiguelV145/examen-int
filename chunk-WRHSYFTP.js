import{C as n,G as a,U as o,W as i,sb as u}from"./chunk-XLQOBEAY.js";var l=class r{router=a(u);token=o(null);user=o(null);roles=o([]);isAuthenticated=o(!1);constructor(){this.loadFromStorage(),i(()=>{let e=this.token()!==null;this.isAuthenticated.set(e)}),i(()=>{let e=this.user();this.roles.set(e?.roles||[])})}setAuth(e){this.token.set(e.token),this.user.set({id:e.userId,username:e.username,email:e.email,roles:e.roles}),this.persistToStorage()}logout(){this.token.set(null),this.user.set(null),this.roles.set([]),localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),this.router.navigate(["/login"])}hasRole(e){return this.roles().includes(e)}isAdmin(){return this.hasRole("ADMIN")}persistToStorage(){let e=this.token(),t=this.user();e&&localStorage.setItem("auth_token",e),t&&localStorage.setItem("auth_user",JSON.stringify(t))}loadFromStorage(){let e=localStorage.getItem("auth_token"),t=localStorage.getItem("auth_user");if(e&&this.token.set(e),t)try{let s=JSON.parse(t);this.user.set(s)}catch(s){console.error("Error parsing user from storage:",s),this.logout()}}static \u0275fac=function(t){return new(t||r)};static \u0275prov=n({token:r,factory:r.\u0275fac,providedIn:"root"})};export{l as a};
