import{a as N}from"./chunk-C6EO5WWD.js";import{h as T}from"./chunk-VJMJNAVC.js";import{Ca as S,Na as E,P as f,Pa as C,Qb as h,Ra as R,Sa as D,T as p,U as u,Xa as a,Ya as n,Za as A,ab as b,bb as _,da as x,eb as g,fb as r,mb as I,nb as s,ob as v,pb as c,ra as d}from"./chunk-7Z5RBHX5.js";var M=(i,e)=>e.id;function w(i,e){i&1&&(a(0,"div",2),A(1,"span",5),n())}function F(i,e){i&1&&(a(0,"div",3)(1,"span"),s(2,"No tienes asesor\xEDas pendientes."),n()())}function k(i,e){if(i&1&&(a(0,"div",13)(1,"p",17),s(2,"Notas del cliente:"),n(),a(3,"p",18),s(4),n()()),i&2){let t=r().$implicit;d(4),v(t.notes)}}function $(i,e){if(i&1){let t=b();a(0,"button",19),g("click",function(){p(t);let l=r().$implicit,m=r(2);return u(m.updateStatus(l.id,"CONFIRMADA"))}),s(1," Confirmar "),n(),a(2,"button",20),g("click",function(){p(t);let l=r().$implicit,m=r(2);return u(m.updateStatus(l.id,"RECHAZADA"))}),s(3," Rechazar "),n()}if(i&2){let t=r().$implicit,o=r(2);_("disabled",o.updatingId()===t.id),d(2),_("disabled",o.updatingId()===t.id)}}function V(i,e){if(i&1){let t=b();a(0,"button",21),g("click",function(){p(t);let l=r().$implicit,m=r(2);return u(m.updateStatus(l.id,"EN_CURSO"))}),s(1," Iniciar "),n()}if(i&2){let t=r().$implicit,o=r(2);_("disabled",o.updatingId()===t.id)}}function L(i,e){if(i&1){let t=b();a(0,"button",19),g("click",function(){p(t);let l=r().$implicit,m=r(2);return u(m.updateStatus(l.id,"COMPLETADA"))}),s(1," Marcar Completada "),n()}if(i&2){let t=r().$implicit,o=r(2);_("disabled",o.updatingId()===t.id)}}function O(i,e){if(i&1&&(a(0,"div",6)(1,"div",7)(2,"div",8),s(3),n(),a(4,"p",9),s(5),n(),A(6,"div",10),a(7,"div",11)(8,"p")(9,"span",12),s(10,"Cliente:"),n(),s(11),n(),a(12,"p")(13,"span",12),s(14,"Email:"),n(),s(15),n(),a(16,"p")(17,"span",12),s(18,"Fecha:"),n(),s(19),n(),a(20,"p")(21,"span",12),s(22,"Duraci\xF3n:"),n(),s(23),n(),a(24,"p")(25,"span",12),s(26,"Modalidad:"),n(),s(27),n()(),E(28,k,5,1,"div",13),a(29,"div",14),E(30,$,4,2)(31,V,2,1,"button",15)(32,L,2,1,"button",16),n()()()),i&2){let t=e.$implicit,o=r(2);d(2),I(o.getStatusBadgeClass(t.status)),d(),c(" ",t.status," "),d(2),v(t.topic||"Sin tema"),d(6),c(" ",t.client==null?null:t.client.username," "),d(4),c(" ",t.client==null?null:t.client.email," "),d(4),c(" ",o.formatDateTime(t.startAt)," "),d(4),c(" ",t.durationMinutes," minutos "),d(4),c(" ",t.modality," "),d(),C(t.notes?28:-1),d(2),C(t.status==="PENDIENTE"?30:t.status==="CONFIRMADA"?31:t.status==="EN_CURSO"?32:-1)}}function P(i,e){if(i&1&&(a(0,"div",4),R(1,O,33,11,"div",6,M),n()),i&2){let t=r();d(),D(t.asesorias())}}var y=class i{asesoriasApi=f(N);toastr=f(T);loading=x(!1);updatingId=x(null);asesorias=x([]);ngOnInit(){this.loadAsesorias()}loadAsesorias(){this.loading.set(!0),this.asesoriasApi.getAsesoriasRecibidas().subscribe({next:e=>{this.asesorias.set(e),this.loading.set(!1)},error:e=>{this.toastr.error(this.getErrorMessage(e,"No se pudieron cargar las asesor\xEDas.")),this.loading.set(!1)}})}updateStatus(e,t){this.updatingId.set(e);let o={status:t};this.asesoriasApi.updateAsesoriaStatus(e,o).subscribe({next:()=>{this.toastr.success(`Estado actualizado a ${t}`),this.updatingId.set(null),this.loadAsesorias()},error:l=>{this.toastr.error(this.getErrorMessage(l,"No se pudo actualizar el estado.")),this.updatingId.set(null)}})}getErrorMessage(e,t){let o=e?.error?.message||e?.error?.details;return o||(e?.status?`Error ${e.status}: ${e.statusText||t}`:e?.message?.includes("Network")?"Error de conexion. Verifica tu conexion a internet.":t)}getStatusBadgeClass(e){return{PENDIENTE:"badge-warning",CONFIRMADA:"badge-info",EN_CURSO:"badge-primary",COMPLETADA:"badge-success",CANCELADA:"badge-error",RECHAZADA:"badge-error"}[e]||"badge-default"}formatDateTime(e){let t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=S({type:i,selectors:[["app-asesorias-recibidas"]],decls:6,vars:1,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","mb-6"],[1,"flex","justify-center","py-8"],[1,"alert","alert-info"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"loading","loading-spinner","loading-lg"],[1,"card","bg-base-100","shadow-lg"],[1,"card-body"],[1,"badge"],[1,"font-semibold","text-lg"],[1,"divider","my-2"],[1,"space-y-2","text-sm"],[1,"font-semibold"],[1,"mt-3"],[1,"card-actions","mt-4","gap-2"],[1,"btn","btn-sm","btn-primary",3,"disabled"],[1,"btn","btn-sm","btn-success",3,"disabled"],[1,"text-xs","opacity-75"],[1,"text-sm"],[1,"btn","btn-sm","btn-success",3,"click","disabled"],[1,"btn","btn-sm","btn-error",3,"click","disabled"],[1,"btn","btn-sm","btn-primary",3,"click","disabled"]],template:function(t,o){t&1&&(a(0,"div",0)(1,"h1",1),s(2,"Asesor\xEDas Recibidas"),n(),E(3,w,2,0,"div",2)(4,F,3,0,"div",3)(5,P,3,0,"div",4),n()),t&2&&(d(3),C(o.loading()?3:o.asesorias().length===0?4:5))},dependencies:[h],encapsulation:2,changeDetection:0})};export{y as AsesoriasRecibidasprogComponent};
