<div class="pt-24 min-h-screen bg-[#0f172a] text-gray-200 font-sans p-4 lg:p-8 pb-20 relative">
  
  <div class="fixed inset-0 pointer-events-none">
    <div class="absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-blue-600/10 rounded-full blur-[120px]"></div>
    <div class="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-purple-600/10 rounded-full blur-[120px]"></div>
  </div>

  <div class="max-w-7xl mx-auto mb-10 flex flex-col md:flex-row justify-between items-center gap-6 relative z-10 animate-fade-in-down">
    <div class="text-center md:text-left">
      <h1 class="text-4xl md:text-5xl font-black text-white tracking-tight mb-2">
        Panel de Control
      </h1>
      <p class="text-gray-400 font-medium text-lg">Administraci√≥n integral del sistema</p>
      
      <!-- Debug: Mostrar roles del usuario actual -->
      @if (authService.currentUser()?.roles && authService.currentUser()!.roles.length > 0) {
        <div class="mt-3 flex flex-wrap gap-2">
          <span class="text-xs text-gray-500 font-semibold">Roles actuales:</span>
          @for (role of authService.currentUser()!.roles; track role) {
            <span class="text-xs font-bold px-2 py-1 rounded-lg"
                  [class.bg-red-900/30]="role === 'ADMIN' || role === 'ROLE_ADMIN'"
                  [class.text-red-400]="role === 'ADMIN' || role === 'ROLE_ADMIN'"
                  [class.border-red-500/30]="role === 'ADMIN' || role === 'ROLE_ADMIN'"
                  [class.bg-blue-900/30]="role === 'PROGRAMADOR'"
                  [class.text-blue-400]="role === 'PROGRAMADOR'"
                  [class.border-blue-500/30]="role === 'PROGRAMADOR'"
                  [class.bg-gray-700/30]="role === 'USER'"
                  [class.text-gray-400]="role === 'USER'"
                  [class.border-gray-500/30]="role === 'USER'"
                  class="border">
              {{ role }}
            </span>
          }
        </div>
      } @else {
        <div class="mt-3">
          <span class="text-xs font-bold px-3 py-1.5 rounded-lg bg-yellow-900/30 text-yellow-400 border border-yellow-500/30">
            ‚ö†Ô∏è No se detectaron roles asignados
          </span>
        </div>
      }
    </div>
    
    <div class="flex items-center gap-4 bg-[#1e293b]/60 backdrop-blur-xl px-6 py-3 rounded-2xl shadow-xl border border-white/5 hover:border-cyan-500/30 transition-all duration-300 group">
      <div class="avatar placeholder">
        <div class="w-12 rounded-full ring-2 ring-[#0f172a] group-hover:ring-cyan-500 transition-all shadow-lg">
          @if (authService.currentUser()?.photoURL) {
            <img [src]="authService.currentUser()?.photoURL" alt="Admin" />
          } @else {
            <div class="bg-gradient-to-br from-cyan-500 to-blue-600 text-white w-full h-full flex items-center justify-center font-bold text-xl">
              {{ authService.currentUser()?.email?.charAt(0)?.toUpperCase() }}
            </div>
          }
        </div>
      </div>
      <div class="text-left">
        <p class="font-bold text-white text-base leading-tight">{{ authService.currentUser()?.displayName || 'Administrador' }}</p>
        <span class="text-[10px] font-bold text-cyan-400 tracking-wider uppercase bg-cyan-900/20 px-2 py-0.5 rounded border border-cyan-500/20">Super Admin</span>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto mb-8 relative z-10">
    <div role="tablist" class="flex p-1 gap-1 bg-[#1e293b]/80 backdrop-blur-md rounded-xl max-w-md mx-auto md:mx-0 border border-white/5 shadow-lg">
      <button role="tab" class="flex-1 py-2.5 px-4 rounded-lg text-sm font-bold transition-all duration-300 flex justify-center items-center gap-2" 
          [class.bg-gradient-to-r]="activeTab() === 'users'"
          [class.from-cyan-600]="activeTab() === 'users'"
          [class.to-blue-600]="activeTab() === 'users'"
          [class.text-white]="activeTab() === 'users'"
          [class.shadow-lg]="activeTab() === 'users'"
          [class.text-gray-400]="activeTab() !== 'users'"
          [class.hover:bg-white/5]="activeTab() !== 'users'"
          [class.hover:text-white]="activeTab() !== 'users'"
          (click)="switchTab('users')">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
          Usuarios
      </button>
      <button role="tab" class="flex-1 py-2.5 px-4 rounded-lg text-sm font-bold transition-all duration-300 flex justify-center items-center gap-2" 
          [class.bg-gradient-to-r]="activeTab() === 'asesorias'"
          [class.from-purple-600]="activeTab() === 'asesorias'"
          [class.to-pink-600]="activeTab() === 'asesorias'"
          [class.text-white]="activeTab() === 'asesorias'"
          [class.shadow-lg]="activeTab() === 'asesorias'"
          [class.text-gray-400]="activeTab() !== 'asesorias'"
          [class.hover:bg-white/5]="activeTab() !== 'asesorias'"
          [class.hover:text-white]="activeTab() !== 'asesorias'"
          (click)="switchTab('asesorias')">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>
          Asesor√≠as
      </button>
    </div>
  </div>

  @if (activeTab() === 'users') {
    <div class="max-w-7xl mx-auto card bg-[#1e293b]/60 backdrop-blur-xl border border-white/5 shadow-2xl overflow-hidden rounded-3xl animate-fade-in relative z-10">
      
      

      <div class="overflow-x-auto">
        <table class="table w-full align-middle">
          <thead class="bg-[#0f172a]/50 text-gray-400 uppercase text-[10px] font-bold tracking-wider border-b border-white/5">
            <tr>
              <th class="pl-8 py-5">Usuario</th>
              <th class="text-center">Rol</th>
              <th class="text-center">Horario</th>
              <th class="text-right pr-8">Acciones</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-white/5">
            @if (users$ | async; as users) {
              @if (users.length > 0) {
                @for (user of users; track user.uid) {
                  <tr class="hover:bg-white/5 transition-colors group">
                  
                  <td class="pl-8 py-4">
                    <div class="flex items-center gap-4">
                      <div class="avatar placeholder">
                        @if (user.photoURL) {
                           <div class="w-10 h-10 rounded-full ring-2 ring-white/10 group-hover:ring-cyan-500 transition-all">
                             <img [src]="user.photoURL" />
                           </div>
                        } @else {
                           <div class="bg-gradient-to-tr from-gray-700 to-gray-600 text-white ring-2 ring-white/10 w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm shadow-inner">
                             {{ user.email.charAt(0).toUpperCase() }}
                           </div>
                        }
                      </div>
                      <div>
                        <div class="font-bold text-gray-200 group-hover:text-cyan-400 transition-colors">{{ user.displayName || 'Sin nombre' }}</div>
                        <div class="text-xs text-gray-500 font-mono">{{ user.email }}</div>
                      </div>
                    </div>
                  </td>

                  <td class="text-center">
                    @if (user.roles?.includes('ADMIN')) {
                      <div class="badge badge-error gap-1 text-red-200 font-bold bg-red-500/10 border-red-500/20 text-xs py-3">üõ°Ô∏è Admin</div>
                    } @else if (user.roles?.includes('PROGRAMADOR')) {
                      <div class="badge badge-info gap-1 text-cyan-200 font-bold bg-cyan-500/10 border-cyan-500/20 text-xs py-3">üíª Dev</div>
                    } @else {
                      <div class="badge badge-ghost text-gray-400 border-white/10 text-xs py-3">User</div>
                    }
                  </td>

                  <td class="text-center">
                    @if (user.roles?.includes('PROGRAMADOR')) {
                      <button (click)="openAvailabilityModal(user)" class="btn btn-xs btn-ghost border border-white/10 hover:border-cyan-500 hover:bg-cyan-500/10 hover:text-cyan-400 transition-all group/btn h-8 px-3 rounded-lg font-normal">
                        @if (user.availability) {
                          <span class="text-emerald-400 font-medium flex items-center gap-2 text-xs">
                            <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse"></span> Configurado
                          </span>
                        } @else {
                          <span class="text-amber-400 font-medium flex items-center gap-1 text-xs">‚ö†Ô∏è Sin Horario</span>
                        }
                      </button>
                    } @else {
                      <span class="text-xs text-gray-600 font-mono select-none">--</span>
                    }
                  </td>

                  <td class="text-right pr-8">
                    @if (!user.roles?.includes('ADMIN')) {
                      <div class="flex justify-end gap-1 opacity-60 group-hover:opacity-100 transition-opacity">
                        <div class="tooltip tooltip-left" [attr.data-tip]="user.roles?.includes('PROGRAMADOR') ? 'Degradar' : 'Ascender'">
                           <button (click)="toggleRole(user)" class="btn btn-sm btn-square btn-ghost hover:bg-white/10 text-gray-400 hover:text-white">
                             @if(user.roles?.includes('PROGRAMADOR')) {‚¨áÔ∏è} @else {‚¨ÜÔ∏è}
                           </button>
                        </div>
                        <div class="tooltip tooltip-left" data-tip="Eliminar">
                           <button (click)="deleteUser(user)" class="btn btn-sm btn-square btn-ghost text-red-400 hover:bg-red-500/10 hover:text-red-300">üóëÔ∏è</button>
                        </div>
                      </div>
                    }
                  </td>
                </tr>
              }
              } @else {
                <tr>
                  <td colspan="4" class="text-center py-16">
                    <div class="flex flex-col items-center gap-4">
                      <div class="w-20 h-20 rounded-full bg-yellow-500/10 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                      </div>
                      <div class="text-center">
                        <p class="text-lg font-bold text-gray-300 mb-2">No se pudieron cargar los usuarios</p>
                        <p class="text-sm text-gray-500 max-w-md">
                          Posibles causas:<br>
                          ‚Ä¢ Tu usuario no tiene el rol ADMIN asignado en el backend<br>
                          ‚Ä¢ El token de sesi√≥n expir√≥<br>
                          ‚Ä¢ El backend no est√° disponible<br>
                          <br>
                          <span class="text-cyan-400 font-semibold">Revisa la consola del navegador (F12) para m√°s detalles</span>
                        </p>
                      </div>
                    </div>
                  </td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>
    </div>
  }

  @if (activeTab() === 'asesorias') {
    <div class="max-w-7xl mx-auto card bg-[#1e293b]/60 backdrop-blur-xl border border-white/5 shadow-2xl overflow-hidden rounded-3xl animate-fade-in relative z-10">
       <div class="p-6 border-b border-white/5 bg-white/[0.02]">
        <h3 class="font-bold text-white text-xl">Supervisi√≥n de Asesor√≠as</h3>
        <p class="text-xs text-gray-500 mt-1">Historial completo de solicitudes en la plataforma.</p>
      </div>

      <div class="overflow-x-auto">
        <table class="table w-full align-middle">
          <thead class="bg-[#0f172a]/50 text-gray-400 uppercase text-[10px] font-bold tracking-wider border-b border-white/5">
            <tr>
              <th class="pl-8 py-5">Cliente</th>
              <th>Programador</th>
              <th>Fecha/Hora</th>
              <th class="text-center">Estado</th>
              <th class="pr-8">Respuesta</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-white/5">
            @if (asesorias$ | async; as asesorias) {
              @for (cita of asesorias; track cita.id) {
                <tr class="hover:bg-white/5 transition-colors">
                  
                  <td class="pl-8 py-4 font-bold text-white">{{ cita.clientName }}</td>
                  <td class="font-medium text-cyan-400">{{ cita.programmerName }}</td>
                  
                  <td>
                    <div class="flex flex-col">
                      <span class="font-bold text-gray-300 text-sm">{{ cita.date }}</span>
                      <span class="text-xs text-gray-500 font-mono">{{ cita.time }}</span>
                    </div>
                  </td>
                  
                  <td class="text-center">
                    @switch (cita.status) {
                      @case ('pendiente') { <span class="badge badge-warning bg-amber-500/10 text-amber-300 border-amber-500/20 gap-1 font-bold text-xs py-3 animate-pulse">‚è≥ Pendiente</span> }
                      @case ('aprobada') { <span class="badge badge-success bg-emerald-500/10 text-emerald-300 border-emerald-500/20 gap-1 font-bold text-xs py-3">‚úÖ Aprobada</span> }
                      @case ('rechazada') { <span class="badge badge-error bg-red-500/10 text-red-300 border-red-500/20 gap-1 font-bold text-xs py-3">‚ùå Rechazada</span> }
                    }
                  </td>

                  <td class="pr-8 text-sm italic opacity-70 max-w-[200px] truncate" [title]="cita.responseMsg">
                    {{ cita.responseMsg || 'Esperando respuesta...' }}
                  </td>

                </tr>
              }
              @empty {
                <tr><td colspan="5" class="text-center py-24 opacity-30 text-gray-400 font-medium text-lg">No hay solicitudes registradas.</td></tr>
              }
            }
          </tbody>
        </table>
      </div>
    </div>
  }

</div>