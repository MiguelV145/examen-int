import{h as U}from"./chunk-VJMJNAVC.js";import{l as k,m as T,p as I}from"./chunk-O7I4AEB5.js";import{$b as j,Ca as R,K as w,Na as y,P as h,Pa as A,Qb as C,Ra as D,Sa as S,T as p,Ta as g,U as m,Ua as r,Ub as F,V as x,Va as i,Vb as P,W as v,Wa as c,ab as _,da as f,db as b,fb as u,nb as a,ob as l,ra as s}from"./chunk-7Z5RBHX5.js";var E=class o{http=h(P);baseUrl=`${j.apiUrl}/api/reports`;getAsesoriasSummary(t){let e=this.buildFilters(t);return this.http.get(`${this.baseUrl}/asesorias-summary`,{params:e})}getAsesoriasByProgrammer(t){let e=this.buildFilters(t);return this.http.get(`${this.baseUrl}/asesorias-by-programmer`,{params:e})}getAsesoriasByDate(t){let e=this.buildFilters(t);return this.http.get(`${this.baseUrl}/asesorias-by-date`,{params:e})}getProjectsByUser(t){let e=this.buildFilters(t);return this.http.get(`${this.baseUrl}/projects-by-user`,{params:e})}getAdminDashboard(t){let e=this.buildFilters(t);return this.http.get(`${this.baseUrl}/dashboard`,{params:e})}downloadAsesoriasPdf(t){let e=this.buildFilters(t);return this.http.get(`${this.baseUrl}/download/asesorias-pdf`,{params:e,responseType:"blob"})}downloadAsesoriasXlsx(t){let e=this.buildFilters(t);return this.http.get(`${this.baseUrl}/download/asesorias-xlsx`,{params:e,responseType:"blob"})}downloadProjectsPdf(t){let e=this.buildFilters(t);return this.http.get(`${this.baseUrl}/download/projects-pdf`,{params:e,responseType:"blob"})}downloadProjectsXlsx(t){let e=this.buildFilters(t);return this.http.get(`${this.baseUrl}/download/projects-xlsx`,{params:e,responseType:"blob"})}buildFilters(t){let e=new F;return t&&(t.startDate&&(e=e.set("startDate",t.startDate)),t.endDate&&(e=e.set("endDate",t.endDate)),t.programmerId&&(e=e.set("programmerId",t.programmerId.toString())),t.status&&(e=e.set("status",t.status)),t.userId&&(e=e.set("userId",t.userId.toString()))),e}downloadFile(t,e){let n=window.URL.createObjectURL(t),d=document.createElement("a");d.href=n,d.download=e,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(n)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=w({token:o,factory:o.\u0275fac,providedIn:"root"})};var $=(o,t)=>t.status,O=(o,t)=>t.programmerId,N=(o,t)=>t.userId;function V(o,t){o&1&&(r(0,"div",18),c(1,"span",19),i())}function L(o,t){if(o&1&&(r(0,"tr")(1,"td"),a(2),i(),r(3,"td")(4,"span",39),a(5),i()()()),o&2){let e=t.$implicit;s(2),l(e.status),s(3),l(e.count)}}function H(o,t){if(o&1&&(r(0,"tr")(1,"td"),a(2),i(),r(3,"td")(4,"span",39),a(5),i()()()),o&2){let e=t.$implicit;s(2),l(e.programmerName),s(3),l(e.count)}}function X(o,t){if(o&1&&(r(0,"tr")(1,"td"),a(2),i(),r(3,"td"),a(4),i(),r(5,"td")(6,"span",39),a(7),i()(),r(8,"td")(9,"span",40),a(10),i()()()),o&2){let e=t.$implicit;s(2),l(e.userName),s(2),l(e.email),s(3),l(e.totalProjects),s(3),l(e.activeProjects)}}function G(o,t){if(o&1){let e=_();r(0,"div",20)(1,"div",21)(2,"div",22),x(),r(3,"svg",23),c(4,"path",24),i()(),v(),r(5,"div",25),a(6,"Total de Asesor\xEDas"),i(),r(7,"div",26),a(8),i()(),r(9,"div",21)(10,"div",27),x(),r(11,"svg",23),c(12,"path",28),i()(),v(),r(13,"div",25),a(14,"Programadores"),i(),r(15,"div",26),a(16),i()(),r(17,"div",21)(18,"div",29),x(),r(19,"svg",23),c(20,"path",30),i()(),v(),r(21,"div",25),a(22,"Total de Usuarios"),i(),r(23,"div",26),a(24),i()()(),r(25,"div",31)(26,"div",32)(27,"div",6)(28,"h2",7),a(29,"Asesor\xEDas por Estado"),i(),r(30,"div",33)(31,"table",34)(32,"thead")(33,"tr")(34,"th"),a(35,"Estado"),i(),r(36,"th"),a(37,"Cantidad"),i()()(),r(38,"tbody"),D(39,L,6,2,"tr",null,$),i()()()()(),r(41,"div",32)(42,"div",6)(43,"h2",7),a(44,"Asesor\xEDas por Programador"),i(),r(45,"div",33)(46,"table",34)(47,"thead")(48,"tr")(49,"th"),a(50,"Programador"),i(),r(51,"th"),a(52,"Cantidad"),i()()(),r(53,"tbody"),D(54,H,6,2,"tr",null,O),i()()()()(),r(56,"div",35)(57,"div",6)(58,"h2",7),a(59,"Proyectos por Usuario"),i(),r(60,"div",33)(61,"table",34)(62,"thead")(63,"tr")(64,"th"),a(65,"Usuario"),i(),r(66,"th"),a(67,"Email"),i(),r(68,"th"),a(69,"Total"),i(),r(70,"th"),a(71,"Activos"),i()()(),r(72,"tbody"),D(73,X,11,4,"tr",null,N),i()()()()()(),r(75,"div",36)(76,"div",6)(77,"h2",7),a(78,"Descargar Reportes"),i(),r(79,"div",37)(80,"button",38),b("click",function(){p(e);let d=u();return m(d.downloadReport("asesorias-pdf"))}),a(81," PDF Asesor\xEDas "),i(),r(82,"button",38),b("click",function(){p(e);let d=u();return m(d.downloadReport("asesorias-xlsx"))}),a(83," XLSX Asesor\xEDas "),i(),r(84,"button",38),b("click",function(){p(e);let d=u();return m(d.downloadReport("projects-pdf"))}),a(85," PDF Proyectos "),i(),r(86,"button",38),b("click",function(){p(e);let d=u();return m(d.downloadReport("projects-xlsx"))}),a(87," XLSX Proyectos "),i()()()()}if(o&2){let e=u();s(8),l(e.dashboardData().totalAsesorias),s(8),l(e.dashboardData().totalProgrammers),s(8),l(e.dashboardData().totalUsers),s(15),S(e.dashboardData().asesoriasBySatus),s(15),S(e.dashboardData().asesoriasByProgrammer),s(19),S(e.dashboardData().projectsByUser),s(7),g("disabled",e.downloadingReport()),s(2),g("disabled",e.downloadingReport()),s(2),g("disabled",e.downloadingReport()),s(2),g("disabled",e.downloadingReport())}}var B=class o{reportsApi=h(E);toastr=h(U);loading=f(!1);downloadingReport=f(!1);dashboardData=f(null);currentFilters={};ngOnInit(){this.loadDashboard()}loadDashboard(){this.loading.set(!0),this.reportsApi.getAdminDashboard(this.currentFilters).subscribe({next:t=>{this.dashboardData.set(t),this.loading.set(!1)},error:t=>{this.toastr.error(this.getErrorMessage(t,"No se pudo cargar el dashboard.")),this.loading.set(!1)}})}applyFilters(){this.loadDashboard()}downloadReport(t){this.downloadingReport.set(!0);let e,n="";switch(t){case"asesorias-pdf":e=this.reportsApi.downloadAsesoriasPdf(this.currentFilters),n=`asesorias-${new Date().toISOString().split("T")[0]}.pdf`;break;case"asesorias-xlsx":e=this.reportsApi.downloadAsesoriasXlsx(this.currentFilters),n=`asesorias-${new Date().toISOString().split("T")[0]}.xlsx`;break;case"projects-pdf":e=this.reportsApi.downloadProjectsPdf(this.currentFilters),n=`proyectos-${new Date().toISOString().split("T")[0]}.pdf`;break;case"projects-xlsx":e=this.reportsApi.downloadProjectsXlsx(this.currentFilters),n=`proyectos-${new Date().toISOString().split("T")[0]}.xlsx`;break;default:return}e.subscribe({next:d=>{this.reportsApi.downloadFile(d,n),this.toastr.success("Descarga completada"),this.downloadingReport.set(!1)},error:d=>{this.toastr.error(this.getErrorMessage(d,"No se pudo descargar el reporte.")),this.downloadingReport.set(!1)}})}getErrorMessage(t,e){let n=t?.error?.message||t?.error?.details;return n||(t?.status?`Error ${t.status}: ${t.statusText||e}`:t?.message?.includes("Network")?"Error de conexion. Verifica tu conexion a internet.":e)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=R({type:o,selectors:[["app-admin-reportes-dashboard"]],decls:28,vars:1,consts:[["startDate",""],["endDate",""],["statusFilter",""],[1,"container","mx-auto","px-4","py-8"],[1,"text-3xl","font-bold","mb-6"],[1,"card","bg-base-200","mb-6"],[1,"card-body"],[1,"card-title"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-4"],["type","date","placeholder","Fecha inicio",1,"input","input-bordered"],["type","date","placeholder","Fecha fin",1,"input","input-bordered"],[1,"select","select-bordered"],["value",""],["value","PENDIENTE"],["value","CONFIRMADA"],["value","COMPLETADA"],["value","CANCELADA"],[1,"btn","btn-primary",3,"click"],[1,"flex","justify-center","py-8"],[1,"loading","loading-spinner","loading-lg"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","mb-6"],[1,"stat","bg-base-100","rounded-box","shadow"],[1,"stat-figure","text-primary"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"stat-title"],[1,"stat-value"],[1,"stat-figure","text-success"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4.354a4 4 0 110 5.292m0 0H8.646m3.354 0H16m-4-8a4 4 0 110 5.292m0 0H8.646m3.354 0H16"],[1,"stat-figure","text-info"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M17 20h5v-2a3 3 0 00-5.856-1.487M15 6a3 3 0 11-6 0 3 3 0 016 0zM6 20a3 3 0 003-3v-2a3 3 0 00-3-3"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"card","bg-base-100","shadow-lg"],[1,"overflow-x-auto"],[1,"table","table-sm"],[1,"card","bg-base-100","shadow-lg","lg:col-span-2"],[1,"card","bg-base-100","shadow-lg","mt-6"],[1,"grid","grid-cols-2","md:grid-cols-4","gap-2"],[1,"btn","btn-outline",3,"click","disabled"],[1,"badge"],[1,"badge","badge-primary"]],template:function(e,n){if(e&1){let d=_();r(0,"div",3)(1,"h1",4),a(2,"Panel de Reportes"),i(),r(3,"div",5)(4,"div",6)(5,"h2",7),a(6,"Filtros"),i(),r(7,"div",8),c(8,"input",9,0)(10,"input",10,1),r(12,"select",11,2)(14,"option",12),a(15,"Todos los estados"),i(),r(16,"option",13),a(17,"Pendiente"),i(),r(18,"option",14),a(19,"Confirmada"),i(),r(20,"option",15),a(21,"Completada"),i(),r(22,"option",16),a(23,"Cancelada"),i()(),r(24,"button",17),b("click",function(){return p(d),m(n.applyFilters())}),a(25," Aplicar Filtros "),i()()()(),y(26,V,2,0,"div",18)(27,G,88,7),i()}e&2&&(s(26),A(n.loading()?26:n.dashboardData()?27:-1))},dependencies:[C,I,k,T],encapsulation:2,changeDetection:0})};export{B as AdminReportesDashboardComponent};
