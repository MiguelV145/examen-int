import{a as U}from"./chunk-B6QT5BOB.js";import{a as B}from"./chunk-N7LSAEK4.js";import{h as j}from"./chunk-O5TH4FWR.js";import{a as L,c as M,d as _,i as C,j as V}from"./chunk-7TQHRDDG.js";import{a as T,b as x,c as I,d as P,g as N,i as A,j as H,n as G,p as D}from"./chunk-G2VJRUEM.js";import{$b as R,Ca as k,Na as c,P as u,Pa as p,Qb as F,Ta as b,Ua as t,V as m,Va as i,W as g,Wa as s,da as w,db as S,fb as h,lb as y,nb as l,ob as v,qa as E,ra as a}from"./chunk-UHECLRXO.js";function z(r,e){if(r&1&&(t(0,"div",13),m(),t(1,"svg",32),s(2,"path",33),i(),g(),t(3,"span",34),l(4),i()()),r&2){let o=h();a(4),v(o.errorMessage())}}function $(r,e){if(r&1&&(t(0,"div",23),m(),t(1,"svg",35),s(2,"path",36),i(),g(),t(3,"span"),l(4),i()()),r&2){let o=h();a(4),v(o.formUtils.getFieldError(o.loginForm,"identifier"))}}function O(r,e){if(r&1&&(t(0,"div",23),m(),t(1,"svg",35),s(2,"path",36),i(),g(),t(3,"span"),l(4),i()()),r&2){let o=h();a(4),v(o.formUtils.getFieldError(o.loginForm,"password"))}}function W(r,e){r&1&&(s(0,"span",37),l(1," Iniciando sesi\xF3n... "))}function J(r,e){r&1&&(l(0," Iniciar Sesi\xF3n "),m(),t(1,"svg",38),s(2,"path",39),i())}function K(r,e){r&1&&(t(0,"p",28),l(1," \u23F3 Esto puede tardar hasta 60 segundos si el servidor est\xE1 inici\xE1ndose... "),i())}var q=class r{fb=u(G);authApiService=u(B);authStore=u(V);router=u(M);route=u(L);toastr=u(j);loading=w(!1);errorMessage=w(null);loginForm;formUtils=U;isLoggingIn=!1;constructor(){this.loginForm=this.fb.group({identifier:["",[x.required]],password:["",[x.required,x.minLength(6)]]})}ngOnInit(){this.route.queryParams.subscribe(e=>{e.registered==="true"&&e.message&&this.toastr.info(e.message,"Registro Exitoso",{timeOut:5e3})})}unloadNotification(e){this.isLoggingIn&&(e.returnValue=!0)}onSubmit(){if(this.loginForm.invalid){this.loginForm.markAllAsTouched();return}this.isLoggingIn=!0,this.loading.set(!0),this.errorMessage.set(null);let e=this.loginForm.getRawValue(),o=(e.identifier||"").trim(),n=e.password||"";if(!o||!n){this.errorMessage.set("Email y contrase\xF1a son requeridos"),this.isLoggingIn=!1,this.loading.set(!1),this.loginForm.markAllAsTouched();return}let f={email:o,password:n};console.log("\u{1F510} Enviando login request:",{email:f.email,passwordLength:f.password.length,url:`${R.apiUrl}/api/auth/login`}),console.log("\u23F3 Nota: Si es la primera petici\xF3n, Render puede tardar 30-60 segundos en despertar..."),this.authApiService.login(f).subscribe({next:d=>{console.log("\u2705 Login exitoso:",{userId:d.userId,username:d.username}),this.authStore.setAuth(d),this.isLoggingIn=!1,this.loading.set(!1),this.router.navigate(["/home"])},error:d=>{console.error("\u274C Error en login:",d),this.isLoggingIn=!1,this.loading.set(!1),this.errorMessage.set(this.getErrorMessage(d))}})}getErrorMessage(e){if(e?.error?.message&&console.error("\u{1F4CB} Respuesta del backend:",e.error),e?.status)switch(e.status){case 400:return`Validaci\xF3n: ${e.error?.message||e.error?.details||"Datos inv\xE1lidos"}`;case 401:return"Credenciales inv\xE1lidas. Verifica tu email y contrase\xF1a.";case 404:return"Usuario no encontrado. Por favor, reg\xEDstrate primero.";case 500:return"Error del servidor. Intenta m\xE1s tarde.";default:return e.error?.message||`Error ${e.status}: ${e.statusText||"Error desconocido"}`}return e?.message?.includes("Network")?"Error de conexi\xF3n. Verifica tu conexi\xF3n a internet.":e?.message||"Error en el login. Intenta de nuevo."}static \u0275fac=function(o){return new(o||r)};static \u0275cmp=k({type:r,selectors:[["app-login-page"]],hostBindings:function(o,n){o&1&&S("beforeunload",function(d){return n.unloadNotification(d)},E)},decls:47,vars:11,consts:[[1,"min-h-screen","flex","items-center","justify-center","bg-[#0f172a]","relative","overflow-hidden","font-sans","selection:bg-cyan-500","selection:text-white"],[1,"absolute","inset-0","pointer-events-none"],[1,"absolute","top-[-10%]","left-[-10%]","w-[600px]","h-[600px]","bg-blue-600/20","rounded-full","blur-[120px]","animate-pulse"],[1,"absolute","bottom-[-10%]","right-[-10%]","w-[600px]","h-[600px]","bg-purple-600/20","rounded-full","blur-[120px]"],[1,"card","w-full","max-w-md","bg-[#1e293b]/70","backdrop-blur-2xl","border","border-white/10","shadow-[0_0_50px_rgba(0,0,0,0.5)]","relative","z-10","transition-all","duration-500","hover:shadow-cyan-500/10","rounded-3xl","overflow-hidden"],[1,"absolute","top-0","left-0","w-full","h-1","bg-gradient-to-r","from-transparent","via-cyan-500","to-transparent","opacity-50"],[1,"card-body","p-8","sm:p-10"],[1,"text-center","mb-8"],[1,"inline-flex","items-center","justify-center","w-16","h-16","rounded-2xl","bg-gradient-to-tr","from-cyan-500/20","to-blue-600/20","mb-6","ring-1","ring-white/10","shadow-lg","shadow-cyan-500/20","group"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"w-8","h-8","text-cyan-400","drop-shadow-md","group-hover:scale-110","transition-transform","duration-300"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"],[1,"text-3xl","font-black","text-white","tracking-tight","mb-2"],[1,"text-gray-400","text-sm","font-medium"],["role","alert",1,"alert","alert-error","bg-red-500/10","border","border-red-500/20","text-red-200","mb-6","py-3","px-4","rounded-xl","text-sm","flex","items-center","gap-3","animate-bounce-in","shadow-lg","shadow-red-900/20"],[1,"space-y-5",3,"ngSubmit","formGroup"],[1,"form-control"],[1,"label","pl-1","pb-1"],[1,"label-text","text-gray-400","font-bold","text-xs","uppercase","tracking-wider"],[1,"relative","group"],[1,"absolute","left-4","top-1/2","-translate-y-1/2","text-gray-500","group-focus-within:text-cyan-400","transition-colors","pointer-events-none"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"],["type","text","formControlName","identifier","placeholder","correo@ejemplo.com o usuario",1,"input","bg-[#0f172a]/50","border-white/10","text-white","w-full","pl-11","focus:border-cyan-500","focus:bg-[#0f172a]","focus:ring-1","focus:ring-cyan-500","transition-all","placeholder:text-gray-600","rounded-xl","font-medium","h-12"],[1,"text-red-400","text-xs","mt-1.5","ml-1","flex","items-center","gap-1","font-medium","animate-fade-in"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"],["type","password","formControlName","password","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"input","bg-[#0f172a]/50","border-white/10","text-white","w-full","pl-11","focus:border-cyan-500","focus:bg-[#0f172a]","focus:ring-1","focus:ring-cyan-500","transition-all","placeholder:text-gray-600","rounded-xl","font-medium","h-12"],[1,"form-control","pt-2"],["type","submit",1,"btn","btn-primary","w-full","border-0","bg-gradient-to-r","from-cyan-600","to-blue-600","hover:from-cyan-500","hover:to-blue-500","shadow-lg","shadow-cyan-500/20","hover:shadow-cyan-500/40","hover:scale-[1.02]","transition-all","duration-300","text-white","font-bold","rounded-xl","h-12","min-h-0","uppercase","tracking-wide","text-sm",3,"disabled"],[1,"text-xs","text-gray-400","mt-2","text-center"],[1,"text-center","mt-8","pt-4","border-t","border-white/5"],[1,"text-sm","text-gray-500"],["routerLink","/register",1,"text-cyan-400","hover:text-cyan-300","font-bold","hover:underline","transition-colors","ml-1","cursor-pointer"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"stroke-current","shrink-0","h-5","w-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"font-semibold"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-3","w-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"loading","loading-spinner","loading-sm"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-5","w-5","ml-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M14 5l7 7m0 0l-7 7m7-7H3"]],template:function(o,n){o&1&&(t(0,"div",0)(1,"div",1),s(2,"div",2)(3,"div",3),i(),t(4,"div",4),s(5,"div",5),t(6,"div",6)(7,"div",7)(8,"div",8),m(),t(9,"svg",9),s(10,"path",10),i()(),g(),t(11,"h1",11),l(12,"\xA1Bienvenido de nuevo!"),i(),t(13,"p",12),l(14,"Accede a tu panel de control"),i()(),c(15,z,5,1,"div",13),t(16,"form",14),S("ngSubmit",function(){return n.onSubmit()}),t(17,"div",15)(18,"label",16)(19,"span",17),l(20,"Email o Usuario"),i()(),t(21,"div",18)(22,"span",19),m(),t(23,"svg",20),s(24,"path",21),i()(),g(),s(25,"input",22),i(),c(26,$,5,1,"div",23),i(),t(27,"div",15)(28,"label",16)(29,"span",17),l(30,"Contrase\xF1a"),i()(),t(31,"div",18)(32,"span",19),m(),t(33,"svg",20),s(34,"path",24),i()(),g(),s(35,"input",25),i(),c(36,O,5,1,"div",23),i(),t(37,"div",26)(38,"button",27),c(39,W,2,0)(40,J,3,0),i(),c(41,K,2,0,"p",28),i()(),t(42,"div",29)(43,"p",30),l(44," \xBFNo tienes cuenta? "),t(45,"a",31),l(46," Reg\xEDstrate aqu\xED "),i()()()()()()),o&2&&(a(15),p(n.errorMessage()?15:-1),a(),b("formGroup",n.loginForm),a(9),y("input-error",n.formUtils.isValidField(n.loginForm,"identifier")),a(),p(n.formUtils.isValidField(n.loginForm,"identifier")?26:-1),a(9),y("input-error",n.formUtils.isValidField(n.loginForm,"password")),a(),p(n.formUtils.isValidField(n.loginForm,"password")?36:-1),a(2),b("disabled",n.loading()),a(),p(n.loading()?39:40),a(2),p(n.loading()?41:-1))},dependencies:[F,D,N,T,I,P,H,A,C,_],encapsulation:2,changeDetection:0})};export{q as LoginPage};
