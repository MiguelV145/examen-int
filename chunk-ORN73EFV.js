import{g as q,i as M,l as $,m as O,n as g,q as w}from"./chunk-R2INFCKZ.js";import{b as y,k as L,l as j,m as B}from"./chunk-MPB6UECF.js";import{Ca as a,Da as n,E as f,Ea as u,Ha as k,I as v,Ia as h,J as E,K as A,L as N,La as b,Ma as l,Pa as P,Ra as r,S as x,Sa as _,Ta as C,Ya as D,Za as U,ba as S,da as d,eb as H,fb as R,ka as V,ra as z,sa as s,ua as c,wa as T,wb as I,xa as F}from"./chunk-HYWXO3E6.js";var W=(e,t)=>t.uid,J=(e,t)=>t.id;function K(e,t){if(e&1&&u(0,"img",11),e&2){let i,o=l();h("src",(i=o.authService.currentUser())==null?null:i.photoURL,S)}}function Q(e,t){if(e&1&&(a(0,"div",12),r(1),n()),e&2){let i,o=l();d(),C(" ",(i=o.authService.currentUser())==null||i.email==null||(i=i.email.charAt(0))==null?null:i.toUpperCase()," ")}}function X(e,t){if(e&1&&(a(0,"div",33),u(1,"img",43),n()),e&2){let i=l().$implicit;d(),h("src",i.photoURL,S)}}function Y(e,t){if(e&1&&(a(0,"div",34),r(1),n()),e&2){let i=l().$implicit;d(),C(" ",i.email.charAt(0).toUpperCase()," ")}}function Z(e,t){e&1&&(a(0,"div",37),r(1,"\u{1F6E1}\uFE0F Admin"),n())}function ee(e,t){e&1&&(a(0,"div",38),r(1,"\u{1F4BB} Dev"),n())}function te(e,t){e&1&&(a(0,"div",39),r(1,"User"),n())}function ie(e,t){e&1&&(a(0,"span",45),u(1,"span",47),r(2," Configurado "),n())}function oe(e,t){e&1&&(a(0,"span",46),r(1,"\u26A0\uFE0F Sin Horario"),n())}function ne(e,t){if(e&1){let i=k();a(0,"button",44),b("click",function(){v(i);let m=l().$implicit,p=l(3);return E(p.openAvailabilityModal(m))}),s(1,ie,3,0,"span",45)(2,oe,2,0,"span",46),n()}if(e&2){let i=l().$implicit;d(),c(i.availability?1:2)}}function ae(e,t){e&1&&(a(0,"span",41),r(1,"--"),n())}function re(e,t){e&1&&r(0,"\u2B07\uFE0F")}function de(e,t){e&1&&r(0,"\u2B06\uFE0F")}function le(e,t){if(e&1){let i=k();a(0,"div",42)(1,"div",48)(2,"button",49),b("click",function(){v(i);let m=l().$implicit,p=l(3);return E(p.toggleRole(m))}),s(3,re,1,0)(4,de,1,0),n()(),a(5,"div",50)(6,"button",51),b("click",function(){v(i);let m=l().$implicit,p=l(3);return E(p.deleteUser(m))}),r(7,"\u{1F5D1}\uFE0F"),n()()()}if(e&2){let i=l().$implicit;d(),z("data-tip",i.role==="Programador"?"Degradar":"Ascender"),d(2),c(i.role==="Programador"?3:4)}}function me(e,t){if(e&1&&(a(0,"tr",30)(1,"td",31)(2,"div",32)(3,"div",9),s(4,X,2,1,"div",33)(5,Y,2,1,"div",34),n(),a(6,"div")(7,"div",35),r(8),n(),a(9,"div",36),r(10),n()()()(),a(11,"td",27),s(12,Z,2,0,"div",37)(13,ee,2,0,"div",38)(14,te,2,0,"div",39),n(),a(15,"td",27),s(16,ne,3,1,"button",40)(17,ae,2,0,"span",41),n(),a(18,"td",28),s(19,le,8,2,"div",42),n()()),e&2){let i,o=t.$implicit;d(4),c(o.photoURL?4:5),d(4),_(o.displayName||"Sin nombre"),d(2),_(o.email),d(2),c((i=o.role)==="admin"?12:i==="Programador"?13:14),d(4),c(o.role==="Programador"?16:17),d(3),c(o.role!=="admin"?19:-1)}}function se(e,t){e&1&&T(0,me,20,6,"tr",30,W),e&2&&F(t)}function ce(e,t){if(e&1&&(a(0,"div",22)(1,"div",23)(2,"table",24)(3,"thead",25)(4,"tr")(5,"th",26),r(6,"Usuario"),n(),a(7,"th",27),r(8,"Rol"),n(),a(9,"th",27),r(10,"Horario"),n(),a(11,"th",28),r(12,"Acciones"),n()()(),a(13,"tbody",29),s(14,se,2,0),D(15,"async"),n()()()()),e&2){let i,o=l();d(14),c((i=U(15,1,o.users$))?14:-1,i)}}function pe(e,t){e&1&&(a(0,"span",61),r(1,"\u23F3 Pendiente"),n())}function _e(e,t){e&1&&(a(0,"span",62),r(1,"\u2705 Aprobada"),n())}function ue(e,t){e&1&&(a(0,"span",63),r(1,"\u274C Rechazada"),n())}function xe(e,t){if(e&1&&(a(0,"tr",56)(1,"td",57),r(2),n(),a(3,"td",58),r(4),n(),a(5,"td")(6,"div",59)(7,"span",60),r(8),n(),a(9,"span",36),r(10),n()()(),a(11,"td",27),s(12,pe,2,0,"span",61)(13,_e,2,0,"span",62)(14,ue,2,0,"span",63),n(),a(15,"td",64),r(16),n()()),e&2){let i,o=t.$implicit;d(2),_(o.clientName),d(2),_(o.programmerName),d(4),_(o.date),d(2),_(o.time),d(2),c((i=o.status)==="pendiente"?12:i==="aprobada"?13:i==="rechazada"?14:-1),d(3),h("title",o.responseMsg),d(),C(" ",o.responseMsg||"Esperando respuesta..."," ")}}function be(e,t){e&1&&(a(0,"tr")(1,"td",65),r(2,"No hay solicitudes registradas."),n()())}function ge(e,t){e&1&&T(0,xe,17,7,"tr",56,J,!1,be,3,0,"tr"),e&2&&F(t)}function fe(e,t){if(e&1&&(a(0,"div",22)(1,"div",52)(2,"h3",53),r(3,"Supervisi\xF3n de Asesor\xEDas"),n(),a(4,"p",54),r(5,"Historial completo de solicitudes en la plataforma."),n()(),a(6,"div",23)(7,"table",24)(8,"thead",25)(9,"tr")(10,"th",26),r(11,"Cliente"),n(),a(12,"th"),r(13,"Programador"),n(),a(14,"th"),r(15,"Fecha/Hora"),n(),a(16,"th",27),r(17,"Estado"),n(),a(18,"th",55),r(19,"Respuesta"),n()()(),a(20,"tbody",29),s(21,ge,3,1),D(22,"async"),n()()()()),e&2){let i,o=l();d(21),c((i=U(22,1,o.asesorias$))?21:-1,i)}}var G=class e{firestore=f(q);authService=f(I);fb=f(L);users$;asesorias$;loading=x(!1);showCreateModal=x(!1);showAvailabilityModal=x(!1);activeTab=x("users");selectedProgrammer=x(null);formUtils=B;availabilityForm=this.fb.group({dias:["",y.required],startHour:["09:00",y.required],endHour:["17:00",y.required]});constructor(){let t=$(this.firestore,"users");this.users$=M(t,{idField:"uid"});let i=$(this.firestore,"asesorias");this.asesorias$=M(i,{idField:"id"})}switchTab(t){this.activeTab.set(t)}async toggleRole(t){if(t.uid===this.authService.currentUser()?.uid)return alert(" No puedes cambiar tu propio rol.");if(t.role==="admin")return alert(" No puedes modificar a otro Admin.");let i=t.role==="Programador"?"user":"Programador";if(confirm(`\xBFCambiar rol de ${t.displayName} a ${i}?`))try{await w(g(this.firestore,"users",t.uid),{role:i})}catch(o){console.error(o)}}async deleteUser(t){if(t.uid===this.authService.currentUser()?.uid)return alert(" No puedes eliminarte.");if(t.role==="admin")return alert(" No puedes borrar Admins.");if(confirm(`\xBFEliminar a ${t.email} permanentemente?`))try{await O(g(this.firestore,"users",t.uid))}catch(i){console.error(i)}}openAvailabilityModal(t){if(t.role!=="Programador")return;this.selectedProgrammer.set(t);let i=t.availability?.horas||"",[o,m]=i.includes(" - ")?i.split(" - "):["09:00","17:00"];this.availabilityForm.patchValue({dias:t.availability?.dias||"Lunes a Viernes",startHour:o.trim(),endHour:m.trim()}),this.showAvailabilityModal.set(!0)}closeAvailabilityModal(){this.showAvailabilityModal.set(!1),this.selectedProgrammer.set(null)}async saveAvailability(){let t=this.selectedProgrammer();if(!t||this.availabilityForm.invalid){this.availabilityForm.markAllAsTouched();return}this.loading.set(!0);try{let{dias:i,startHour:o,endHour:m}=this.availabilityForm.value,p={dias:i,horas:`${o} - ${m}`};await w(g(this.firestore,"users",t.uid),{availability:p}),alert("\u2705 Horario actualizado."),this.closeAvailabilityModal()}catch(i){console.error(i),alert("Error al guardar.")}finally{this.loading.set(!1)}}async updateAsesoriaStatus(t,i){if(t.id&&confirm(`\xBF${i==="aprobada"?"Aprobar":"Rechazar"} cita de ${t.clientName}?`))try{await w(g(this.firestore,"asesorias",t.id),{status:i,responseMsg:i==="aprobada"?"Confirmada por Admin.":"Cancelada por Admin."})}catch(o){console.error(o)}}static \u0275fac=function(i){return new(i||e)};static \u0275cmp=V({type:e,selectors:[["app-adminpage"]],decls:32,vars:36,consts:[[1,"pt-24","min-h-screen","bg-[#0f172a]","text-gray-200","font-sans","p-4","lg:p-8","pb-20","relative"],[1,"fixed","inset-0","pointer-events-none"],[1,"absolute","top-[-10%]","left-[-10%]","w-[500px]","h-[500px]","bg-blue-600/10","rounded-full","blur-[120px]"],[1,"absolute","bottom-[-10%]","right-[-10%]","w-[500px]","h-[500px]","bg-purple-600/10","rounded-full","blur-[120px]"],[1,"max-w-7xl","mx-auto","mb-10","flex","flex-col","md:flex-row","justify-between","items-center","gap-6","relative","z-10","animate-fade-in-down"],[1,"text-center","md:text-left"],[1,"text-4xl","md:text-5xl","font-black","text-white","tracking-tight","mb-2"],[1,"text-gray-400","font-medium","text-lg"],[1,"flex","items-center","gap-4","bg-[#1e293b]/60","backdrop-blur-xl","px-6","py-3","rounded-2xl","shadow-xl","border","border-white/5","hover:border-cyan-500/30","transition-all","duration-300","group"],[1,"avatar","placeholder"],[1,"w-12","rounded-full","ring-2","ring-[#0f172a]","group-hover:ring-cyan-500","transition-all","shadow-lg"],["alt","Admin",3,"src"],[1,"bg-gradient-to-br","from-cyan-500","to-blue-600","text-white","w-full","h-full","flex","items-center","justify-center","font-bold","text-xl"],[1,"text-left"],[1,"font-bold","text-white","text-base","leading-tight"],[1,"text-[10px]","font-bold","text-cyan-400","tracking-wider","uppercase","bg-cyan-900/20","px-2","py-0.5","rounded","border","border-cyan-500/20"],[1,"max-w-7xl","mx-auto","mb-8","relative","z-10"],["role","tablist",1,"flex","p-1","gap-1","bg-[#1e293b]/80","backdrop-blur-md","rounded-xl","max-w-md","mx-auto","md:mx-0","border","border-white/5","shadow-lg"],["role","tab",1,"flex-1","py-2.5","px-4","rounded-lg","text-sm","font-bold","transition-all","duration-300","flex","justify-center","items-center","gap-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"],[1,"max-w-7xl","mx-auto","card","bg-[#1e293b]/60","backdrop-blur-xl","border","border-white/5","shadow-2xl","overflow-hidden","rounded-3xl","animate-fade-in","relative","z-10"],[1,"overflow-x-auto"],[1,"table","w-full","align-middle"],[1,"bg-[#0f172a]/50","text-gray-400","uppercase","text-[10px]","font-bold","tracking-wider","border-b","border-white/5"],[1,"pl-8","py-5"],[1,"text-center"],[1,"text-right","pr-8"],[1,"divide-y","divide-white/5"],[1,"hover:bg-white/5","transition-colors","group"],[1,"pl-8","py-4"],[1,"flex","items-center","gap-4"],[1,"w-10","h-10","rounded-full","ring-2","ring-white/10","group-hover:ring-cyan-500","transition-all"],[1,"bg-gradient-to-tr","from-gray-700","to-gray-600","text-white","ring-2","ring-white/10","w-10","h-10","rounded-full","flex","items-center","justify-center","font-bold","text-sm","shadow-inner"],[1,"font-bold","text-gray-200","group-hover:text-cyan-400","transition-colors"],[1,"text-xs","text-gray-500","font-mono"],[1,"badge","badge-error","gap-1","text-red-200","font-bold","bg-red-500/10","border-red-500/20","text-xs","py-3"],[1,"badge","badge-info","gap-1","text-cyan-200","font-bold","bg-cyan-500/10","border-cyan-500/20","text-xs","py-3"],[1,"badge","badge-ghost","text-gray-400","border-white/10","text-xs","py-3"],[1,"btn","btn-xs","btn-ghost","border","border-white/10","hover:border-cyan-500","hover:bg-cyan-500/10","hover:text-cyan-400","transition-all","group/btn","h-8","px-3","rounded-lg","font-normal"],[1,"text-xs","text-gray-600","font-mono","select-none"],[1,"flex","justify-end","gap-1","opacity-60","group-hover:opacity-100","transition-opacity"],[3,"src"],[1,"btn","btn-xs","btn-ghost","border","border-white/10","hover:border-cyan-500","hover:bg-cyan-500/10","hover:text-cyan-400","transition-all","group/btn","h-8","px-3","rounded-lg","font-normal",3,"click"],[1,"text-emerald-400","font-medium","flex","items-center","gap-2","text-xs"],[1,"text-amber-400","font-medium","flex","items-center","gap-1","text-xs"],[1,"w-1.5","h-1.5","rounded-full","bg-emerald-400","animate-pulse"],[1,"tooltip","tooltip-left"],[1,"btn","btn-sm","btn-square","btn-ghost","hover:bg-white/10","text-gray-400","hover:text-white",3,"click"],["data-tip","Eliminar",1,"tooltip","tooltip-left"],[1,"btn","btn-sm","btn-square","btn-ghost","text-red-400","hover:bg-red-500/10","hover:text-red-300",3,"click"],[1,"p-6","border-b","border-white/5","bg-white/[0.02]"],[1,"font-bold","text-white","text-xl"],[1,"text-xs","text-gray-500","mt-1"],[1,"pr-8"],[1,"hover:bg-white/5","transition-colors"],[1,"pl-8","py-4","font-bold","text-white"],[1,"font-medium","text-cyan-400"],[1,"flex","flex-col"],[1,"font-bold","text-gray-300","text-sm"],[1,"badge","badge-warning","bg-amber-500/10","text-amber-300","border-amber-500/20","gap-1","font-bold","text-xs","py-3","animate-pulse"],[1,"badge","badge-success","bg-emerald-500/10","text-emerald-300","border-emerald-500/20","gap-1","font-bold","text-xs","py-3"],[1,"badge","badge-error","bg-red-500/10","text-red-300","border-red-500/20","gap-1","font-bold","text-xs","py-3"],[1,"pr-8","text-sm","italic","opacity-70","max-w-[200px]","truncate",3,"title"],["colspan","5",1,"text-center","py-24","opacity-30","text-gray-400","font-medium","text-lg"]],template:function(i,o){if(i&1&&(a(0,"div",0)(1,"div",1),u(2,"div",2)(3,"div",3),n(),a(4,"div",4)(5,"div",5)(6,"h1",6),r(7," Panel de Control "),n(),a(8,"p",7),r(9,"Administraci\xF3n integral del sistema"),n()(),a(10,"div",8)(11,"div",9)(12,"div",10),s(13,K,1,1,"img",11)(14,Q,2,1,"div",12),n()(),a(15,"div",13)(16,"p",14),r(17),n(),a(18,"span",15),r(19,"Super Admin"),n()()()(),a(20,"div",16)(21,"div",17)(22,"button",18),b("click",function(){return o.switchTab("users")}),A(),a(23,"svg",19),u(24,"path",20),n(),r(25," Usuarios "),n(),N(),a(26,"button",18),b("click",function(){return o.switchTab("asesorias")}),A(),a(27,"svg",19),u(28,"path",21),n(),r(29," Asesor\xEDas "),n()()(),s(30,ce,16,3,"div",22),s(31,fe,23,3,"div",22),n()),i&2){let m,p;d(13),c((m=o.authService.currentUser())!=null&&m.photoURL?13:14),d(4),_(((p=o.authService.currentUser())==null?null:p.displayName)||"Administrador"),d(5),P("bg-gradient-to-r",o.activeTab()==="users")("from-cyan-600",o.activeTab()==="users")("to-blue-600",o.activeTab()==="users")("text-white",o.activeTab()==="users")("shadow-lg",o.activeTab()==="users")("text-gray-400",o.activeTab()!=="users")("hover:bg-white/5",o.activeTab()!=="users")("hover:text-white",o.activeTab()!=="users"),d(4),P("bg-gradient-to-r",o.activeTab()==="asesorias")("from-purple-600",o.activeTab()==="asesorias")("to-pink-600",o.activeTab()==="asesorias")("text-white",o.activeTab()==="asesorias")("shadow-lg",o.activeTab()==="asesorias")("text-gray-400",o.activeTab()!=="asesorias")("hover:bg-white/5",o.activeTab()!=="asesorias")("hover:text-white",o.activeTab()!=="asesorias"),d(4),c(o.activeTab()==="users"?30:-1),d(),c(o.activeTab()==="asesorias"?31:-1)}},dependencies:[R,j,H],encapsulation:2,changeDetection:0})};export{G as Adminpage};
