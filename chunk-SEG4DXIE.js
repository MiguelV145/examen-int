import{a as ee}from"./chunk-VJ3LKAAA.js";import{a as Y}from"./chunk-B6QT5BOB.js";import"./chunk-OJLLPRL7.js";import{a as ie}from"./chunk-BE5W4ASK.js";import{h as te}from"./chunk-U4HXKE5J.js";import"./chunk-PU3QYFWA.js";import{b as y,l as K,n as Q}from"./chunk-5QZEWJ4F.js";import{$b as X,C as D,Ca as B,D as V,E as j,K as H,Ma as q,Na as c,P as u,Pa as p,Pb as J,Qb as W,Ra as N,Sa as M,T as E,U as v,V as R,Vb as Z,W as G,Xa as a,Ya as o,Za as g,ab as k,bb as C,da as h,eb as b,fb as m,g as L,k as S,lb as I,nb as r,o as T,oa as F,ob as _,p as z,pb as A,ra as l,w as U,yb as P,zb as $}from"./chunk-UCITUGDO.js";var w=class i{http=u(Z);baseUrl=`${X.apiUrl}/api/users`;getUsers(){return this.http.get(this.baseUrl)}updateUserRoles(e,t){return this.http.put(`${this.baseUrl}/${e}/roles`,{roleNames:t})}deleteUser(e){return this.http.delete(`${this.baseUrl}/${e}`)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=H({token:i,factory:i.\u0275fac,providedIn:"root"})};var de=(i,e)=>e.uid,le=(i,e)=>e.id;function se(i,e){if(i&1&&g(0,"img",11),i&2){let t,n=m();C("src",(t=n.authService.currentUser())==null?null:t.photoURL,F)}}function me(i,e){if(i&1&&(a(0,"div",12),r(1),o()),i&2){let t,n=m();l(),A(" ",(t=n.authService.currentUser())==null||t.email==null||(t=t.email.charAt(0))==null?null:t.toUpperCase()," ")}}function ce(i,e){if(i&1&&(a(0,"div",33),g(1,"img",43),o()),i&2){let t=m().$implicit;l(),C("src",t.photoURL,F)}}function pe(i,e){if(i&1&&(a(0,"div",34),r(1),o()),i&2){let t=m().$implicit;l(),A(" ",t.email.charAt(0).toUpperCase()," ")}}function ue(i,e){i&1&&(a(0,"div",37),r(1,"\u{1F6E1}\uFE0F Admin"),o())}function _e(i,e){i&1&&(a(0,"div",38),r(1,"\u{1F4BB} Dev"),o())}function ge(i,e){i&1&&(a(0,"div",39),r(1,"User"),o())}function be(i,e){i&1&&(a(0,"span",45),g(1,"span",47),r(2," Configurado "),o())}function xe(i,e){i&1&&(a(0,"span",46),r(1,"\u26A0\uFE0F Sin Horario"),o())}function fe(i,e){if(i&1){let t=k();a(0,"button",44),b("click",function(){E(t);let s=m().$implicit,d=m(3);return v(d.openAvailabilityModal(s))}),c(1,be,3,0,"span",45)(2,xe,2,0,"span",46),o()}if(i&2){let t=m().$implicit;l(),p(t.availability?1:2)}}function Ee(i,e){i&1&&(a(0,"span",41),r(1,"--"),o())}function ve(i,e){i&1&&r(0,"\u2B07\uFE0F")}function he(i,e){i&1&&r(0,"\u2B06\uFE0F")}function Ce(i,e){if(i&1){let t=k();a(0,"div",42)(1,"div",48)(2,"button",49),b("click",function(){E(t);let s=m().$implicit,d=m(3);return v(d.toggleRole(s))}),c(3,ve,1,0)(4,he,1,0),o()(),a(5,"div",50)(6,"button",51),b("click",function(){E(t);let s=m().$implicit,d=m(3);return v(d.deleteUser(s))}),r(7,"\u{1F5D1}\uFE0F"),o()()()}if(i&2){let t=m().$implicit;l(),q("data-tip",t.roles!=null&&t.roles.includes("PROGRAMADOR")?"Degradar":"Ascender"),l(2),p(t.roles!=null&&t.roles.includes("PROGRAMADOR")?3:4)}}function Ae(i,e){if(i&1&&(a(0,"tr",30)(1,"td",31)(2,"div",32)(3,"div",9),c(4,ce,2,1,"div",33)(5,pe,2,1,"div",34),o(),a(6,"div")(7,"div",35),r(8),o(),a(9,"div",36),r(10),o()()()(),a(11,"td",27),c(12,ue,2,0,"div",37)(13,_e,2,0,"div",38)(14,ge,2,0,"div",39),o(),a(15,"td",27),c(16,fe,3,1,"button",40)(17,Ee,2,0,"span",41),o(),a(18,"td",28),c(19,Ce,8,2,"div",42),o()()),i&2){let t=e.$implicit;l(4),p(t.photoURL?4:5),l(4),_(t.displayName||"Sin nombre"),l(2),_(t.email),l(2),p(t.roles!=null&&t.roles.includes("ADMIN")?12:t.roles!=null&&t.roles.includes("PROGRAMADOR")?13:14),l(4),p(t.roles!=null&&t.roles.includes("PROGRAMADOR")?16:17),l(3),p(t.roles!=null&&t.roles.includes("ADMIN")?-1:19)}}function ye(i,e){i&1&&N(0,Ae,20,6,"tr",30,de),i&2&&M(e)}function we(i,e){if(i&1&&(a(0,"div",22)(1,"div",23)(2,"table",24)(3,"thead",25)(4,"tr")(5,"th",26),r(6,"Usuario"),o(),a(7,"th",27),r(8,"Rol"),o(),a(9,"th",27),r(10,"Horario"),o(),a(11,"th",28),r(12,"Acciones"),o()()(),a(13,"tbody",29),c(14,ye,2,0),P(15,"async"),o()()()()),i&2){let t,n=m();l(14),p((t=$(15,1,n.users$))?14:-1,t)}}function Se(i,e){i&1&&(a(0,"span",61),r(1,"\u23F3 Pendiente"),o())}function Te(i,e){i&1&&(a(0,"span",62),r(1,"\u2705 Aprobada"),o())}function Ue(i,e){i&1&&(a(0,"span",63),r(1,"\u274C Rechazada"),o())}function De(i,e){if(i&1&&(a(0,"tr",56)(1,"td",57),r(2),o(),a(3,"td",58),r(4),o(),a(5,"td")(6,"div",59)(7,"span",60),r(8),o(),a(9,"span",36),r(10),o()()(),a(11,"td",27),c(12,Se,2,0,"span",61)(13,Te,2,0,"span",62)(14,Ue,2,0,"span",63),o(),a(15,"td",64),r(16),o()()),i&2){let t,n=e.$implicit;l(2),_(n.clientName),l(2),_(n.programmerName),l(4),_(n.date),l(2),_(n.time),l(2),p((t=n.status)==="pendiente"?12:t==="aprobada"?13:t==="rechazada"?14:-1),l(3),C("title",n.responseMsg),l(),A(" ",n.responseMsg||"Esperando respuesta..."," ")}}function Re(i,e){i&1&&(a(0,"tr")(1,"td",65),r(2,"No hay solicitudes registradas."),o()())}function Fe(i,e){i&1&&N(0,De,17,7,"tr",56,le,!1,Re,3,0,"tr"),i&2&&M(e)}function Ne(i,e){if(i&1&&(a(0,"div",22)(1,"div",52)(2,"h3",53),r(3,"Supervisi\xF3n de Asesor\xEDas"),o(),a(4,"p",54),r(5,"Historial completo de solicitudes en la plataforma."),o()(),a(6,"div",23)(7,"table",24)(8,"thead",25)(9,"tr")(10,"th",26),r(11,"Cliente"),o(),a(12,"th"),r(13,"Programador"),o(),a(14,"th"),r(15,"Fecha/Hora"),o(),a(16,"th",27),r(17,"Estado"),o(),a(18,"th",55),r(19,"Respuesta"),o()()(),a(20,"tbody",29),c(21,Fe,3,1),P(22,"async"),o()()()()),i&2){let t,n=m();l(21),p((t=$(22,1,n.asesorias$))?21:-1,t)}}var ne=class i{authService=u(ee);fb=u(K);usersApi=u(w);asesoriasApi=u(ie);toastr=u(te);refetchTrigger$=new L;users$=this.refetchTrigger$.pipe(V(null),j(()=>this.usersApi.getUsers()),T(e=>e.map(t=>this.mapUser(t))),U(e=>(console.error("No se pudieron cargar usuarios.",e),e.status===403&&this.toastr.error("No tienes permisos de administrador","Error 403"),S([]))),D({bufferSize:1,refCount:!0}));asesorias$=z([this.users$,this.asesoriasApi.getAllAsesorias().pipe(U(e=>(console.error("No se pudieron cargar asesorias.",e),S([]))))]).pipe(T(([e,t])=>this.mapAsesoriasForView(t,e)),D({bufferSize:1,refCount:!0}));loading=h(!1);activeTab=h("users");formUtils=Y;message=h("Panel de administraci\xF3n - Funcionalidad en construcci\xF3n. Conectar con backend cuando est\xE9 listo.");availabilityForm=this.fb.group({dias:["",y.required],startHour:["09:00",y.required],endHour:["17:00",y.required]});constructor(){}switchTab(e){this.activeTab.set(e)}async toggleRole(e){if(!e.uid)return;let t=Number(e.uid),n=e.roles.includes("PROGRAMADOR"),s=n?["USER"]:["PROGRAMADOR","USER"],d=n?"Degradando":"Ascendiendo";this.toastr.info(`${d} a ${e.displayName||e.email}...`),this.usersApi.updateUserRoles(t,s).subscribe({next:()=>{this.toastr.success("Rol actualizado exitosamente","\xC9xito"),this.refetchTrigger$.next()},error:x=>{let f=x?.error?.message||"No se pudo actualizar el rol";this.toastr.error(f,"Error"),console.error("Error al cambiar rol:",x)}})}async deleteUser(e){if(!e.uid||!confirm(`\xBFEst\xE1s seguro de eliminar a ${e.displayName||e.email}?

Esta acci\xF3n no se puede deshacer.`))return;let n=Number(e.uid);this.usersApi.deleteUser(n).subscribe({next:()=>{this.toastr.success("Usuario eliminado exitosamente","\xC9xito"),this.refetchTrigger$.next()},error:s=>{let d=s?.error?.message||"No se pudo eliminar el usuario";this.toastr.error(d,"Error"),console.error("Error al eliminar usuario:",s)}})}openAvailabilityModal(e){}closeAvailabilityModal(){}async saveAvailability(){}async updateAsesoriaStatus(e,t){}mapUser(e){return{uid:String(e.id),email:e.email,roles:e.roles||[],displayName:e.username||e.email}}mapAsesoriasForView(e,t){let n=new Map(t.map(s=>[Number(s.uid),s]));return e.map(s=>{let d=s,x=d.programmer?.id??d.programmerId??0,f=d.client?.id??d.clientId??0,oe=d.programmer?.displayName||d.programmer?.username||this.resolveUserName(n,x,"Programador"),ae=d.client?.username||this.resolveUserName(n,f,"Cliente"),O=this.resolveDateTime(d.startAt,d.date,d.time);return{id:d.id?.toString()||"",programmerId:x.toString(),programmerName:oe,clientId:f.toString(),clientName:ae,date:O.date,time:O.time,comment:d.comment||d.topic||"",status:this.mapStatus(d.status),responseMsg:d.responseMsg||d.notes||void 0}})}resolveUserName(e,t,n){if(!t)return n;let s=e.get(t);return s?.displayName||s?.email||`${n} ${t}`}resolveDateTime(e,t,n){if(e){let s=new Date(e);if(!isNaN(s.getTime()))return{date:s.toLocaleDateString(),time:s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}}return{date:t||"",time:n||""}}mapStatus(e){switch(e){case"PENDIENTE":case"PENDING":return"pendiente";case"CONFIRMADA":case"CONFIRMED":return"aprobada";case"RECHAZADA":case"CANCELADA":case"REJECTED":case"CANCELLED":case"EN_CURSO":case"COMPLETADA":default:return"rechazada"}}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=B({type:i,selectors:[["app-adminpage"]],decls:32,vars:36,consts:[[1,"pt-24","min-h-screen","bg-[#0f172a]","text-gray-200","font-sans","p-4","lg:p-8","pb-20","relative"],[1,"fixed","inset-0","pointer-events-none"],[1,"absolute","top-[-10%]","left-[-10%]","w-[500px]","h-[500px]","bg-blue-600/10","rounded-full","blur-[120px]"],[1,"absolute","bottom-[-10%]","right-[-10%]","w-[500px]","h-[500px]","bg-purple-600/10","rounded-full","blur-[120px]"],[1,"max-w-7xl","mx-auto","mb-10","flex","flex-col","md:flex-row","justify-between","items-center","gap-6","relative","z-10","animate-fade-in-down"],[1,"text-center","md:text-left"],[1,"text-4xl","md:text-5xl","font-black","text-white","tracking-tight","mb-2"],[1,"text-gray-400","font-medium","text-lg"],[1,"flex","items-center","gap-4","bg-[#1e293b]/60","backdrop-blur-xl","px-6","py-3","rounded-2xl","shadow-xl","border","border-white/5","hover:border-cyan-500/30","transition-all","duration-300","group"],[1,"avatar","placeholder"],[1,"w-12","rounded-full","ring-2","ring-[#0f172a]","group-hover:ring-cyan-500","transition-all","shadow-lg"],["alt","Admin",3,"src"],[1,"bg-gradient-to-br","from-cyan-500","to-blue-600","text-white","w-full","h-full","flex","items-center","justify-center","font-bold","text-xl"],[1,"text-left"],[1,"font-bold","text-white","text-base","leading-tight"],[1,"text-[10px]","font-bold","text-cyan-400","tracking-wider","uppercase","bg-cyan-900/20","px-2","py-0.5","rounded","border","border-cyan-500/20"],[1,"max-w-7xl","mx-auto","mb-8","relative","z-10"],["role","tablist",1,"flex","p-1","gap-1","bg-[#1e293b]/80","backdrop-blur-md","rounded-xl","max-w-md","mx-auto","md:mx-0","border","border-white/5","shadow-lg"],["role","tab",1,"flex-1","py-2.5","px-4","rounded-lg","text-sm","font-bold","transition-all","duration-300","flex","justify-center","items-center","gap-2",3,"click"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"],[1,"max-w-7xl","mx-auto","card","bg-[#1e293b]/60","backdrop-blur-xl","border","border-white/5","shadow-2xl","overflow-hidden","rounded-3xl","animate-fade-in","relative","z-10"],[1,"overflow-x-auto"],[1,"table","w-full","align-middle"],[1,"bg-[#0f172a]/50","text-gray-400","uppercase","text-[10px]","font-bold","tracking-wider","border-b","border-white/5"],[1,"pl-8","py-5"],[1,"text-center"],[1,"text-right","pr-8"],[1,"divide-y","divide-white/5"],[1,"hover:bg-white/5","transition-colors","group"],[1,"pl-8","py-4"],[1,"flex","items-center","gap-4"],[1,"w-10","h-10","rounded-full","ring-2","ring-white/10","group-hover:ring-cyan-500","transition-all"],[1,"bg-gradient-to-tr","from-gray-700","to-gray-600","text-white","ring-2","ring-white/10","w-10","h-10","rounded-full","flex","items-center","justify-center","font-bold","text-sm","shadow-inner"],[1,"font-bold","text-gray-200","group-hover:text-cyan-400","transition-colors"],[1,"text-xs","text-gray-500","font-mono"],[1,"badge","badge-error","gap-1","text-red-200","font-bold","bg-red-500/10","border-red-500/20","text-xs","py-3"],[1,"badge","badge-info","gap-1","text-cyan-200","font-bold","bg-cyan-500/10","border-cyan-500/20","text-xs","py-3"],[1,"badge","badge-ghost","text-gray-400","border-white/10","text-xs","py-3"],[1,"btn","btn-xs","btn-ghost","border","border-white/10","hover:border-cyan-500","hover:bg-cyan-500/10","hover:text-cyan-400","transition-all","group/btn","h-8","px-3","rounded-lg","font-normal"],[1,"text-xs","text-gray-600","font-mono","select-none"],[1,"flex","justify-end","gap-1","opacity-60","group-hover:opacity-100","transition-opacity"],[3,"src"],[1,"btn","btn-xs","btn-ghost","border","border-white/10","hover:border-cyan-500","hover:bg-cyan-500/10","hover:text-cyan-400","transition-all","group/btn","h-8","px-3","rounded-lg","font-normal",3,"click"],[1,"text-emerald-400","font-medium","flex","items-center","gap-2","text-xs"],[1,"text-amber-400","font-medium","flex","items-center","gap-1","text-xs"],[1,"w-1.5","h-1.5","rounded-full","bg-emerald-400","animate-pulse"],[1,"tooltip","tooltip-left"],[1,"btn","btn-sm","btn-square","btn-ghost","hover:bg-white/10","text-gray-400","hover:text-white",3,"click"],["data-tip","Eliminar",1,"tooltip","tooltip-left"],[1,"btn","btn-sm","btn-square","btn-ghost","text-red-400","hover:bg-red-500/10","hover:text-red-300",3,"click"],[1,"p-6","border-b","border-white/5","bg-white/[0.02]"],[1,"font-bold","text-white","text-xl"],[1,"text-xs","text-gray-500","mt-1"],[1,"pr-8"],[1,"hover:bg-white/5","transition-colors"],[1,"pl-8","py-4","font-bold","text-white"],[1,"font-medium","text-cyan-400"],[1,"flex","flex-col"],[1,"font-bold","text-gray-300","text-sm"],[1,"badge","badge-warning","bg-amber-500/10","text-amber-300","border-amber-500/20","gap-1","font-bold","text-xs","py-3","animate-pulse"],[1,"badge","badge-success","bg-emerald-500/10","text-emerald-300","border-emerald-500/20","gap-1","font-bold","text-xs","py-3"],[1,"badge","badge-error","bg-red-500/10","text-red-300","border-red-500/20","gap-1","font-bold","text-xs","py-3"],[1,"pr-8","text-sm","italic","opacity-70","max-w-[200px]","truncate",3,"title"],["colspan","5",1,"text-center","py-24","opacity-30","text-gray-400","font-medium","text-lg"]],template:function(t,n){if(t&1&&(a(0,"div",0)(1,"div",1),g(2,"div",2)(3,"div",3),o(),a(4,"div",4)(5,"div",5)(6,"h1",6),r(7," Panel de Control "),o(),a(8,"p",7),r(9,"Administraci\xF3n integral del sistema"),o()(),a(10,"div",8)(11,"div",9)(12,"div",10),c(13,se,1,1,"img",11)(14,me,2,1,"div",12),o()(),a(15,"div",13)(16,"p",14),r(17),o(),a(18,"span",15),r(19,"Super Admin"),o()()()(),a(20,"div",16)(21,"div",17)(22,"button",18),b("click",function(){return n.switchTab("users")}),R(),a(23,"svg",19),g(24,"path",20),o(),r(25," Usuarios "),o(),G(),a(26,"button",18),b("click",function(){return n.switchTab("asesorias")}),R(),a(27,"svg",19),g(28,"path",21),o(),r(29," Asesor\xEDas "),o()()(),c(30,we,16,3,"div",22),c(31,Ne,23,3,"div",22),o()),t&2){let s,d;l(13),p((s=n.authService.currentUser())!=null&&s.photoURL?13:14),l(4),_(((d=n.authService.currentUser())==null?null:d.displayName)||"Administrador"),l(5),I("bg-gradient-to-r",n.activeTab()==="users")("from-cyan-600",n.activeTab()==="users")("to-blue-600",n.activeTab()==="users")("text-white",n.activeTab()==="users")("shadow-lg",n.activeTab()==="users")("text-gray-400",n.activeTab()!=="users")("hover:bg-white/5",n.activeTab()!=="users")("hover:text-white",n.activeTab()!=="users"),l(4),I("bg-gradient-to-r",n.activeTab()==="asesorias")("from-purple-600",n.activeTab()==="asesorias")("to-pink-600",n.activeTab()==="asesorias")("text-white",n.activeTab()==="asesorias")("shadow-lg",n.activeTab()==="asesorias")("text-gray-400",n.activeTab()!=="asesorias")("hover:bg-white/5",n.activeTab()!=="asesorias")("hover:text-white",n.activeTab()!=="asesorias"),l(4),p(n.activeTab()==="users"?30:-1),l(),p(n.activeTab()==="asesorias"?31:-1)}},dependencies:[W,Q,J],encapsulation:2,changeDetection:0})};export{ne as Adminpage};
